# 🐼 しゃべれっさー！

レッサーパンダとの擬似会話を楽しめる Web デモアプリです。

**特徴**: Web Audio API の「粒合成風」再生により、毎回少し違う鳴き方を演出し、"生成っぽい"体験を提供します。

## 📋 概要

- **フレームワーク**: Next.js 15 (App Router) + TypeScript
- **スタイリング**: Tailwind CSS v4
- **音声技術**: Web Audio API（粒合成風再生）
- **機能**: ルールベースの音声返答 + 自動発話システム
- **対応デバイス**: デスクトップ・モバイル（iOS/Android）
- **デプロイ**: Vercel 対応（外部 API 不要）

## 🎯 機能

### 🗣️ 会話機能

- ユーザー入力に基づいてレッサーパンダが応答
- タグマッチングによる適切な返答選択
- 一致しない場合はランダム返答
- 「考え中...」状態の演出（250ms）

### 🎵 粒合成風音声再生

- **毎回違う鳴き方**: MP3 を短い粒に分けてランダム再生
- **ピッチ変化**: ±3 半音の変化で表情豊かに
- **速度変化**: 0.85〜1.15 倍でゆらぎを演出
- **簡易リバーブ**: 空間的な広がりを追加
- **3 種類のベース音源**: はらぺこ系・あそぼ系・あいさつ系
- **モバイル対応**: iOS/Android の音声制限に完全対応

### 🧪 自動発話実験

- 10〜20 秒間隔でレッサーパンダが「自由にしゃべる」
- 初回ユーザー操作後に有効化
- 30 秒間操作がない場合のみ作動

### 💬 プリセット質問（アクセシビリティ対応）

- 「こんにちは！」（あいさつ系）
- 「ごはん何が好き？」（はらぺこ系）
- 「あそぼ！」（あそぼ系）
- 「おまかせで鳴く」（ランダム）
- 各ボタンに aria-label 付き、フォーカスリング表示

## 🚀 セットアップ

### 前提条件

- Node.js 18.17 以上
- npm / yarn / pnpm

### インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd zoo-hackathon-demo

# 依存関係をインストール
npm install
```

### MP3 ファイルの配置（重要）

以下のパスに音声ファイルを配置してください：

```
public/sounds/
├── red_panda_voice1.mp3  # はらぺこ系（粒合成のベース音源）
├── red_panda_voice2.mp3  # あそぼ系（粒合成のベース音源）
└── red_panda_voice3.mp3  # あいさつ系（粒合成のベース音源）
```

**注意**: ファイル名は厳守してください。Web Audio API が各ファイルを読み込んで粒合成処理を行います。

### 開発サーバー起動

```bash
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開いてください。

## 📁 プロジェクト構成

```
zoo-hackathon-demo/
├── public/
│   └── sounds/             # MP3音声ファイル（粒合成ベース）
├── src/
│   ├── app/
│   │   ├── globals.css     # グローバルスタイル
│   │   ├── layout.tsx      # レイアウト
│   │   └── page.tsx        # メインページ（自動発話・Web Audio統合）
│   ├── components/
│   │   ├── Bubble.tsx      # 吹き出しコンポーネント
│   │   └── QuickChips.tsx  # プリセット質問ボタン（アクセシビリティ対応）
│   ├── data/
│   │   └── replies.ts      # 返答ルールとロジック
│   └── lib/
│       └── pandaSpeech.ts  # Web Audio API 粒合成システム
├── README.md
└── package.json
```

## 🌐 Vercel デプロイ

### 自動デプロイ（推奨）

1. [Vercel](https://vercel.com) にログイン
2. 「New Project」をクリック
3. GitHub リポジトリを選択
4. プロジェクト設定はデフォルトのまま「Deploy」

### 手動デプロイ

```bash
# Vercel CLIをインストール
npm i -g vercel

# プロジェクトルートでデプロイ
vercel

# 本番デプロイ
vercel --prod
```

### 環境設定

Vercel では特別な設定は不要です。Next.js プロジェクトとして自動認識されます。

## 🔧 カスタマイズ

### 返答の追加・編集

`src/data/replies.ts` を編集：

```typescript
export const PANDA_REPLIES: PandaReply[] = [
  {
    id: 4,
    src: "/sounds/new_voice.mp3",
    translation: "新しい返答メッセージ",
    tags: ["新しい", "タグ", "キーワード"],
  },
  // ...
];
```

### プリセット質問の変更

`src/components/QuickChips.tsx` の `QUICK_QUESTIONS` 配列を編集

### スタイルの調整

Tailwind CSS クラスを使用してスタイリングを調整可能

## ⚠️ 注意事項

### 🔊 音声について

- **初回操作必須**: iOS/Android の自動再生制限により、初回は必ずボタンタップから開始
- **Web Audio API**: AudioContext を使用するため、モダンブラウザが必要
- **音量注意**: 粒合成により予期しない音量変化が発生する場合があります
- **リバーブ効果**: 簡易リバーブが適用されるため、ヘッドフォン推奨

### 📱 モバイル対応

- **iOS Safari**: Web Audio API 完全対応、初回タップ後はスムーズに動作
- **Android Chrome**: 動作確認済み、自動発話機能も正常動作
- **レスポンシブ**: 画面サイズに応じて最適化

### 🎭 演出について

- **翻訳**: 表示される翻訳は擬似的な演出です
- **毎回違う音**: 粒合成により同じ入力でも微妙に異なる再生結果
- **生成っぽさ**: アルゴリズムによる音声変化で「AI 生成風」を演出

### 📂 ファイルサイズ

- MP3 ファイル: 推奨 1 ファイル 5MB 以下
- 粒合成処理: ファイルサイズが大きいと初回読み込みに時間がかかる場合があります

## 🧪 手動受け入れテスト

### 基本機能テスト

1. **画面表示**: タイトル/説明/入力欄/ボタン/チップ/吹き出し/トグルが正しく表示される
2. **入力テスト**:
   - 「こんにちは！」→ あいさつ系が**毎回少し違う鳴き方**で再生、翻訳表示
   - 「ごはん何が好き？」→ はらぺこ系が同様に再生・表示
   - 「あそぼ！」→ あそぼ系が同様に再生・表示
   - 「おまかせで鳴く」→ 3 種いずれかが**粒合成風**で再生
3. **🧪 トグルテスト**:
   - ON 後 → 10〜20 秒おきに自動で鳴く（手動操作後に作動開始）
   - OFF → 自動発話停止

### モバイルテスト

4. **iOS Safari**: 初回タップ後、音声が正常に再生される
5. **Android Chrome**: 同様に動作する
6. **レスポンシブ**: 各画面サイズで適切に表示される

### 技術テスト

7. **粒合成確認**: 同じ質問を複数回実行し、毎回微妙に違う再生結果
8. **AudioContext**: ブラウザのコンソールエラーがない
9. **アクセシビリティ**: キーボードナビゲーション・スクリーンリーダー対応

## 🏗️ ビルド・テスト

```bash
# プロダクションビルド（Web Audio API対応確認）
npm run build

# ビルド後のローカル確認
npm run start

# リント確認
npm run lint

# TypeScript型チェック
npx tsc --noEmit
```

## 📄 ライセンス

このプロジェクトは動物園ハッカソン用のデモアプリケーションです。

## 🎪 西山動物園案内

🎵 **園内限定の"特別ボイス"**も準備中！
西山動物園で実際のレッサーパンダに会いに来てくださいね 🐾

### 🔗 リンク

- [西山動物園公式サイト](https://www.city.sabae.fukui.jp/about_city/shisetsu_info/kouen/nishiyamadobutsuen.html)
- このアプリは動物園ハッカソン用のデモです

### 💡 技術的な特徴（審査ポイント）

- **完全フロントエンド**: 外部 API 不使用、Vercel だけで動作
- **生成っぽさ**: Web Audio API の粒合成で毎回違う鳴き方を実現
- **リアルタイム性**: ユーザー操作に即応、自動発話機能
- **モバイル最適化**: iOS/Android の音声制限に完全対応
- **アクセシビリティ**: WCAG 準拠、キーボード・スクリーンリーダー対応
